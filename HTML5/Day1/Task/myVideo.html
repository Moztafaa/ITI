<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Task</title>
  </head>
  <body>
    <h1>Custom Video Player</h1>

    <video id="myVideo" width="640" height="360">
      <source src="testVideo.mp4" type="video/mp4" />
      Your browser does not support the video tag.
    </video>

    <br /><br />

    <div id="videoControls">
      <div id="timeDisplay">
        <span id="currentTime">00:00</span> /
        <span id="totalDuration">00:00</span>
      </div>

      <br />

      <div>
        <label for="progressSlider">Progress:</label>
        <input
          type="range"
          id="progressSlider"
          min="0"
          max="100"
          value="0"
          step="0.1"
        />
      </div>

      <br />

      <div id="mainControls">
        <button id="playPauseBtn">Play</button>
        <button id="stopBtn">Stop</button>
        <button id="backward20Btn">&lt;&lt; 20s</button>
        <button id="backward5Btn">&lt; 5s</button>
        <button id="muteBtn">Mute</button>
      </div>

      <br />

      <div>
        <label for="speedSlider"
          >Speed: <span id="speedValue">1.0x</span></label
        >
        <br />
        <input
          type="range"
          id="speedSlider"
          min="0.5"
          max="2"
          value="1"
          step="0.1"
        />
      </div>
    </div>

    <script>
      const video = document.getElementById("myVideo");
      const playPauseBtn = document.getElementById("playPauseBtn");
      const stopBtn = document.getElementById("stopBtn");
      const backward20Btn = document.getElementById("backward20Btn");
      const backward5Btn = document.getElementById("backward5Btn");
      const muteBtn = document.getElementById("muteBtn");
      const progressSlider = document.getElementById("progressSlider");
      const speedSlider = document.getElementById("speedSlider");
      const speedValue = document.getElementById("speedValue");
      const currentTime = document.getElementById("currentTime");
      const totalDuration = document.getElementById("totalDuration");

      let isProgressSliderDragging = false;

      function formatTime(seconds) {
        var mins = Math.floor(seconds / 60);
        var secs = Math.floor(seconds % 60);
        if (mins < 10) mins = "0" + mins;
        if (secs < 10) secs = "0" + secs;
        return mins + ":" + secs;
      }

      playPauseBtn.addEventListener("click", function () {
        if (video.paused) {
          video.play();
          playPauseBtn.textContent = "Pause";
        } else {
          video.pause();
          playPauseBtn.textContent = "Play";
        }
      });

      stopBtn.addEventListener("click", function () {
        video.pause();
        video.currentTime = 0;
        playPauseBtn.textContent = "Play";
      });

      backward20Btn.addEventListener("click", function () {
        video.currentTime = Math.max(0, video.currentTime - 20);
      });

      backward5Btn.addEventListener("click", function () {
        video.currentTime = Math.max(0, video.currentTime - 5);
      });

      muteBtn.addEventListener("click", function () {
        if (video.muted) {
          video.muted = false;
          muteBtn.textContent = "Mute";
        } else {
          video.muted = true;
          muteBtn.textContent = "Unmute";
        }
      });

      speedSlider.addEventListener("input", function () {
        const speed = parseFloat(speedSlider.value);
        video.playbackRate = speed;
        speedValue.textContent = speed.toFixed(1) + "x";
      });

      progressSlider.addEventListener("mousedown", function () {
        isProgressSliderDragging = true;
      });

      progressSlider.addEventListener("mouseup", function () {
        isProgressSliderDragging = false;
        const seekTime = (progressSlider.value / 100) * video.duration;
        video.currentTime = seekTime;
      });

      progressSlider.addEventListener("input", function () {
        if (isProgressSliderDragging) {
          const seekTime = (progressSlider.value / 100) * video.duration;
          currentTime.textContent = formatTime(seekTime);
        }
      });

      video.addEventListener("timeupdate", function () { // fix here 
        if (!isProgressSliderDragging) {
          const progress = (video.currentTime / video.duration) * 100;
          progressSlider.value = progress || 0;
          currentTime.textContent = formatTime(video.currentTime);
        }
      });

      video.addEventListener("loadedmetadata", function () {
        totalDuration.textContent = formatTime(video.duration);
        progressSlider.max = 100;
      });
    </script>
  </body>
</html>
